#!/usr/bin/env python3
"""
Convert PICO-8 sprite data to Picotron format.

PICO-8 sprites are 8x8 pixels stored as hex strings.
Picotron sprites can be any size and are stored in .gfx files.

For K-Razy Shoot-Out, we use 8x12 sprites (two 8x8 PICO-8 sprites stacked).
"""

# PICO-8 sprite data from krazy_shootout.p8
# Each line is 128 hex characters = 64 bytes = 128 pixels (2 pixels per byte)
# We have 16 rows of 16 sprites each = 256 sprites total

pico8_gfx = """
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00007000000070000000700000070000000700000000700000007000088888800888888008888880088888800888888008888880088888800000000000000000
00070700000707000007070000707000007070000007070000070700000880000008800000088000000880000008800000088000000880000000000000000000
00070700000707000007070000707000007070000077070000070770888888880088888800888888888888008888880088888888888888880000000000000000
00007000000070000000700000070000000700000070700000007070808888080088880800888808808888008088880080888808808888080000000000000000
00077700070777000000770000777070007700000007770000077700808888080088880800888808808888008088880080888808808888080000000000000000
00707070007070700000770007070700007700000000707000707000808888080088880800888808808888008088880080888808808888080000000000000000
00707070000070070077770070070000007777000000707000707000808888080088880800888808808888008088880000888808808888000000000000000000
00007000000070700000700007070000000700000000700000007000808888080088880800888808808888008088880000888808808888000000000000000000
00070700000770000007700000077000000770000007070000070700008888000088880000888800008888000088880000888800008888000000000000000000
00070700007007000000770000700700007700000007077000770700008008000080080000008000008008000008000000800880088008000000000000000000
00070700007007770000707077700700070700000007000000000700008008000080080000008000008008000008000000800000000008000000000000000000
00770770077000070007770070000770007770000077000000000770088008800880880000088000008808800008800008800000000008800000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000909000090009009000009000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000900000090900009000900900000900000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000090000009090000999990090999099000900000090900000000000000000000000000000000000000000000000000000000000000000000000000
00009000000999000099999009999999909999909009090000000000000909000000000000000000000000000000000000000000000000000000000000000000
00009000000999000099999009999999909999909009090000000000000909000000000000000000000000000000000000000000000000000000000000000000
00000000000090000009090000999990090999099000900000090900000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000900000090900009000900900000900000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000909000090009009000009000000000000000000000000000000000000000000000000000000000000000000000000
""".strip().split('\n')

def hex_to_pixels(hex_line):
    """Convert a line of hex to pixel values (0-15)."""
    pixels = []
    for i in range(0, len(hex_line), 2):
        byte = hex_line[i:i+2]
        # Each byte contains 2 pixels (4 bits each)
        pixels.append(int(byte[0], 16))
        pixels.append(int(byte[1], 16))
    return pixels

def extract_sprite(sprite_id, width=8, height=8):
    """Extract a single sprite from the PICO-8 gfx data."""
    # Calculate position in the sprite sheet
    sprites_per_row = 16
    row = sprite_id // sprites_per_row
    col = sprite_id % sprites_per_row
    
    # Extract pixels
    sprite_pixels = []
    for y in range(height):
        line_idx = row * 8 + y
        if line_idx >= len(pico8_gfx):
            # Pad with zeros if we're beyond the data
            sprite_pixels.append([0] * width)
            continue
        
        pixels = hex_to_pixels(pico8_gfx[line_idx])
        start_x = col * 8
        sprite_pixels.append(pixels[start_x:start_x + width])
    
    return sprite_pixels

def print_sprite_ascii(sprite_pixels):
    """Print sprite as ASCII art for visualization."""
    chars = ' .:-=+*#%@'
    for row in sprite_pixels:
        line = ''.join(chars[min(p, len(chars)-1)] for p in row)
        print(line)

def create_8x12_sprite(sprite_id):
    """Create an 8x12 sprite by stacking two 8x8 PICO-8 sprites."""
    # Top half (sprite_id)
    top = extract_sprite(sprite_id, 8, 8)
    # Bottom half (sprite_id + 16, next row down)
    bottom = extract_sprite(sprite_id + 16, 8, 4)  # Only take 4 rows
    
    return top + bottom

# Print information about the sprites we need
print("K-Razy Shoot-Out Sprite Map (8x12 pixels each)")
print("=" * 60)
print()

sprite_names = [
    (0, "Player - Standing"),
    (1, "Player - Walking Left 1"),
    (2, "Player - Walking Left 2"),
    (3, "Player - Walking Right 1"),
    (4, "Player - Walking Right 2"),
    (5, "Player - Walking Up/Down 1"),
    (6, "Player - Walking Up/Down 2"),
    (7, "Enemy - Standing"),
    (8, "Enemy - Walking Left 1"),
    (9, "Enemy - Walking Left 2"),
    (10, "Enemy - Walking Right 1"),
    (11, "Enemy - Walking Right 2"),
    (12, "Enemy - Walking Up/Down 1"),
    (13, "Enemy - Walking Up/Down 2"),
]

for sprite_id, name in sprite_names:
    print(f"Sprite {sprite_id}: {name}")
    sprite = create_8x12_sprite(sprite_id)
    print_sprite_ascii(sprite)
    print()

print("\nExplosion Sprites (8x8 pixels each)")
print("=" * 60)
for i in range(8):
    sprite_id = 32 + i
    print(f"Sprite {sprite_id}: Explosion Frame {i+1}")
    sprite = extract_sprite(sprite_id, 8, 8)
    print_sprite_ascii(sprite)
    print()

print("\nTO USE THESE SPRITES IN PICOTRON:")
print("1. Open Picotron and load the cartridge")
print("2. Open the sprite editor (gfx workspace)")
print("3. Manually recreate each sprite using the ASCII art above as reference")
print("4. Save the sprites in gfx/0.gfx")
print()
print("Color mapping:")
print("  0 = Black (transparent)")
print("  7 = White")
print("  8 = Red")
print("  9 = Orange")
