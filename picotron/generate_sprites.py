#!/usr/bin/env python3
"""
Generate Picotron sprite data from PICO-8 sprite sheet.
Converts PICO-8 hex format to Picotron [gfx] format.
"""

# PICO-8 sprite data from krazy_shootout.p8
pico8_gfx = """
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00007000000070000000700000070000000700000000700000007000088888800888888008888880088888800888888008888880088888800000000000000000
00070700000707000007070000707000007070000007070000070700000880000008800000088000000880000008800000088000000880000000000000000000
00070700000707000007070000707000007070000077070000070770888888880088888800888888888888008888880088888888888888880000000000000000
00007000000070000000700000070000000700000070700000007070808888080088880800888808808888008088880080888808808888080000000000000000
00077700070777000000770000777070007700000007770000077700808888080088880800888808808888008088880080888808808888080000000000000000
00707070007070700000770007070700007700000000707000707000808888080088880800888808808888008088880080888808808888080000000000000000
00707070000070070077770070070000007777000000707000707000808888080088880800888808808888008088880000888808808888000000000000000000
00007000000070700000700007070000000700000000700000007000808888080088880800888808808888008088880000888808808888000000000000000000
00070700000770000007700000077000000770000007070000070700008888000088880000888800008888000088880000888800008888000000000000000000
00070700007007000000770000700700007700000007077000770700008008000080080000008000008008000008000000800880088008000000000000000000
00070700007007770000707077700700070700000007000000000700008008000080080000008000008008000008000000800000000008000000000000000000
00770770077000070007770070000770007770000077000000000770088008800880880000088000008808800008800008800000000008800000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000909000090009009000009000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000900000090900009000900900000900000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000090000009090000999990090999099000900000090900000000000000000000000000000000000000000000000000000000000000000000000000
00009000000999000099999009999999909999909009090000000000000909000000000000000000000000000000000000000000000000000000000000000000
00009000000999000099999009999999909999909009090000000000000909000000000000000000000000000000000000000000000000000000000000000000
00000000000090000009090000999990090999099000900000090900000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000900000090900009000900900000900000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000909000090009009000009000000000000000000000000000000000000000000000000000000000000000000000000
""".strip().split('\n')

def extract_sprite_8x8(sprite_id):
    """Extract an 8x8 sprite from PICO-8 data."""
    sprites_per_row = 16
    row = sprite_id // sprites_per_row
    col = sprite_id % sprites_per_row
    
    sprite_data = []
    for y in range(8):
        line_idx = row * 8 + y
        if line_idx >= len(pico8_gfx):
            sprite_data.append("0" * 16)
            continue
        
        # Extract 8 pixels (16 hex chars) for this sprite
        start_x = col * 16
        sprite_data.append(pico8_gfx[line_idx][start_x:start_x + 16])
    
    return "".join(sprite_data)

def extract_sprite_8x12(sprite_id):
    """Extract an 8x12 sprite (two 8x8 sprites stacked)."""
    top = extract_sprite_8x8(sprite_id)
    bottom_id = sprite_id + 16
    bottom = extract_sprite_8x8(bottom_id)
    # Take first 4 rows (64 hex chars) from bottom sprite
    return top + bottom[:64]

def create_gfx_string(width, height, hex_data):
    """Create a Picotron [gfx] format string."""
    # Format: [gfx]WWHHDATA[/gfx]
    # WW = width in hex (2 digits)
    # HH = height in hex (2 digits)
    # DATA = hex pixel data
    w_hex = f"{width:02x}"
    h_hex = f"{height:02x}"
    return f"[gfx]{w_hex}{h_hex}{hex_data}[/gfx]"

# Generate sprite data for all sprites we need
sprites = {}

# Player sprites (8x12)
for i in range(7):
    hex_data = extract_sprite_8x12(i)
    sprites[i] = create_gfx_string(8, 12, hex_data)

# Enemy sprites (8x12)
for i in range(7, 14):
    hex_data = extract_sprite_8x12(i)
    sprites[i] = create_gfx_string(8, 12, hex_data)

# Explosion sprites (8x8)
for i in range(32, 40):
    hex_data = extract_sprite_8x8(i)
    sprites[i] = create_gfx_string(8, 8, hex_data)

# Generate Lua code to create sprites
print("-- Generated sprite data for Picotron")
print("-- Copy this into your cartridge or load it as a separate file")
print()
print("function init_sprites()")
print("  -- Player sprites (8x12)")
for i in range(7):
    print(f'  set_spr({i}, userdata("{sprites[i]}"))')

print()
print("  -- Enemy sprites (8x12)")
for i in range(7, 14):
    print(f'  set_spr({i}, userdata("{sprites[i]}"))')

print()
print("  -- Explosion sprites (8x8)")
for i in range(32, 40):
    print(f'  set_spr({i}, userdata("{sprites[i]}"))')

print("end")
print()
print("-- Call init_sprites() in your _init() function")
